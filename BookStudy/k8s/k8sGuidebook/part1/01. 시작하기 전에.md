# 목차
- 1파트 쿠버네티스 빠르게 훑어보기 (1장)
  - 1.1 쿠버네티스 이해하기
  - 1.2 이 책의 대상 독자
  - 1.3 실습 환경 만들기
  - 1.4 바로 활용하기

# 서론
k8s 인기가 좋은 이유는 독립적이면서 표준적이다.  
쿠버 안에 APP 개발시 어디든 배포 가능하다.  
k8s를 익힌다는 것은 위치에 상관없이 기존 생상선을 유지할 수 있다.

k8s는 LB, 네트워크, 스토리지, 컴퓨팅을 APP 설정 영역으로 데려왔다.

# 1.1 쿠버네티스 이해하기
- 쿠버네티스란?
  - 컨테이너를 실행하는 플랫폼
  - 컨테이너화된 APP의 시작, 롤링 업데이트, 서비스 수준 유지, 스케일링, 보안 접근 등 다양한 기능 제공
  - k8s의 두가지 핵심 개념
    1. API
    2. 클러스터
       - 여러 개의 서버 노드로 구성된 하나의 논리적 단위
  - 컨테이너 오케스트레이션 도구
  
클러스터 관리자는 노드 서버를 관리한다.  
클러스터 처리 용량에 따라 노드 추가, 제거가 가능하고 클러스터 내 노드를 차례로 업데이트 하는 '롤링 업데이트'를 적용 할 수 있다.  
EKS, AKS 등 매니지드 서비스를 통해 k8s 기능을 편리하게 사용 할 수 있다.  

k8s 클러스터의 목적은 앱 실행이다.  
yaml 파일을 통해 앱을 기술하고, k8s API에 전달하면 기술된 APP 구성을 이해하고 클러스터 현재 상태와 비교한다.  
파일에 기술된 상태와 현재 상태의 차이를 체크하고, 차이점이 있다면 컨테이너 추가 또는 제거한다.  
  
컨테이너는 고가용성을 위해 여러 노드에 흩어져 있지만, k8s가 관리하는 가상 네트워크로 서로 통신 가능하다.  
- 간단 정리
  1. APP 구성을 yaml 파일로 작성
  2. yaml 파일 클러스터에 전달
  3. 배포 시작
  4. k8s가 기술된 파일의 원하는 상태로 배포
  - 도커 이미지, k8s yaml 두 가지를 통해 모든 k8s 클러스터에서 동일하게 동작하는 자기수복형 app 생성 가능

- k8s가 관리하는 것
  - 컨테이너
  - 분산 데이터베이스
    - 애플리케이션 구성 정보
    - API Key
    - DB 접속 정보 (민감 정보 안전 보관 가능) 
  - 스토리지
    - 컨테이너 외부에 데이터 저장 가능
  - 트래픽
    - 각 요청 해당 컨테이너 전달 가능

클러스터는 쿠버네티스 API로 들어오는 요청과 APP 요청 모두 감시, 캐치 가능하다.  
따라서 APP 요청은 해당 요청 처리 컨테이너로 전달한다.  
  
k8s는 모든 앱을 yaml 파일로 기술만 한다면 어떤 앱이든 클러스터에서 실행 가능하다.  
- 명칭 개념
  - 애플리케이션 매니페스트(application manifest)
    - 애플리케이션을 기술한 yaml 파일
    - 파일 내용이 APP을 구성하는 모든 컴포넌트 목록이다.
  - 리소스(resource)
    - k8s에서 app을 구성하는 컴포넌트
    - 리소스는 여러 종류가 있다.
      - 서비스 
        - 네트워크 접근을 관리하는 k8s 객체
        - 외부 트래픽을 컨테이너에 전달
        - 컨테이너간 통신 전달
      - 디플로이먼트
        - k8s가 실행한 컨테이너 -> 파드, 레플리카셋, 디플로이먼트 등 객체를 통해 스케일링, 롤링 업데이트 등의 복잡한 패턴 수행 가능
      - 레플리카셋
      - 파드
      - 컨피그맵
        - 설정 정보 등
      - 볼륨
        - 외부 리소스도 k8s 관리 하에 컨테이너에 제공된다.
      - 비밀값
        - 설정 정보 등

# 1.2 이 책의 대상 독자
- k8s 가장 빨리 익히는 방법은 실습이다.
- 컨테이너는 보충 설명하지 않지만, 학습에 필요한 핵심 개념이다.
- k8s 사용시 도커가 꼭 필요하진 않다. -> k8s 실행 앱 패키징에 가장 유연하고 쉬운 것이 도커다.

# 1.3 실습 환경 만들기
실무 k8s 클러스터는 수백 대 이상의 노드로 구성되지만, 학습 목적의 실습은 단일 노드 클러스터로도 충분하다.  
서적에서 k8s version 1.18 사용, 나는 1.29.5 사용  
  
도커 데스크톱 사용시 로컬 컴퓨터에서 간단 K8s 실행 가능하다.  
도커 데스크톱을 통해 도커, k8s, 그 외 명령행 도구 등 한 번에 설치 가능한 패키지로 쓸 수 있다.  
  
k8s 자체의 구성 요소는 리눅스 컨테이너 형태로 실행된다. 
따라서 윈도우는 k8s 자체를 실행할 수 없지만, 도커 데스크톱 사용시 VM까지 활용해 사용 할 수 있게 된다.  

## 1.3.1 이 책의 예제 코드 내려받기
- git clone https://github.com/gilbutItbook/kiamol
- 실습 환경 준비
  - Rancher Desktop 설치 추천
    - https://rancherdesktop.io/
    - localhost가 아닌 별도 IP 주소 설정이 된다.
    - localhost 사용 필요시 도커 데스크톱 사용
  - Docker Desktop 설치
    - 설정 -> 쿠버네티스 탭 -> enable k8s 체크
    - 도커 데스크톱 아래 k8s 표시가 초록색 되면, k8s 클러스터 정상 동작
- 설치 후 1.3.7 절로 넘어가도 된다.

## 1.3.3 도커 커뮤니티 에디션과 K3s 설치하기
- 리눅스 컴퓨터, 리눅스 가상 머신 사용시 단일 노드 클러스트 실행 방법이 몇 가지 더 있다.
  - 카인드(Kuberntes In Docker, Kind)
  - 미니큐브(Minikube)
  - K3s (필자 추천) 
    - 필요한 최소 기능만 설치하는 개념의 배포판 -> 책 실습 기능 모두 탑재
    - K8s를 비튼 이름이다. (?)
    - 코드 베이스를 크게 덜어내고 K8s 대비 절반 정도의 용량만 차지
    - 도커와 연동되므로, 먼저 도커 커뮤니티 에디션 설치 필요
      - 도커 설치
        - curl -fsSL https://get.docker.com | sh
      - K3s 설치
        - curl -sfL https://get.k3s.io | sh -s - --docker -disable=traefik --write-kubeconfig-mode=644
- K3s 설치만 한다면, 1.3.7절로 넘어가도 된다. 

## 1.3.4 쿠버네티스 명령행 도구 설치하기
k8ssms kubectl(큐브-커틀)이라는 명령행 도구를 사용한다.  
kubectl는 K8s 클러스터 접속 후 K8s API를 이용해 클러스터를 관리한다.  
도커 데스크톱과 K3s 설치시 kubectl이 함께 설치된다.  
- kubectl 설치가 필요한 경우
  - brew install Kubernetes-cli

## 1.3.5 애저 환경에서 단일 노드 K8s 클러스터 실행하기

## 1.3.6 AWS에서 단일 노드 K8s 클러스터 실행하기
- EKS(Elastic Kuberntes Service, EKS)
  - AWS 포털에서도 생성 가능하지만, 전용 도구인 eksctl 사용하는 편이 좋다.
    - eksctl 참조 문서 링크: https://eksctl.io
- eksctl 설치
  - Mac OS
    - brew tap weaveworks/tap
    - brew install weaveworks/tap/eksctl
  - 리눅스
    - curl --silent --location "https://github.com/weaveworks/eksctl/releases/download/latest/eksctl_$(uname-s)_amd64.tar.gz" | tar xz -C /tmp
    - sudo mv /tmp eksctl /usr/local/bin
- 단일 노드 클러스터 생성
  - eksctl create cluster --name=kiamol --nodes=1 --node-type=t3.large
    - 두 개의 CPU 코어, 8GB 메모리를 가진 단일 노드 클러스터 생성

## 1.3.7 생성한 클러스터 확인하기
- 클러스터 동작 확인 명령어
  - kubectl get nodes
    - 클러스터를 구성하는 각 노드의 기본 정보 출력
    - 도커 데스크톱 사용 -> 단일 노드 클러스터

# 1.4 바로 활용하기
gogogo

# 해당 파트 사용 명령어 모음
- kubectl get nodes
