오케스트레이션은 여러 대의 물리 서버에 걸쳐 컨테이너로 애플리케이션을 실행하는 것을 말한다.
직접 컨테이너를 관리하는 것과는 달리 클러스터에 컨테이너 관리를 위임한다.

# 12장 컨테이너 오케스트레이션: 도커 스웜과 쿠버네티스
대량의 트래픽 처리, 고가용성을 얻기 위해 여러 대의 도커 호스트로 구성된 운영 환경에서 앱 실행 방법을 알아보자.
여전히 컨테이너를 통해 앱을 실행하지만, 여러 대의 도커 호스트와 컨테이너를 관리해주는 레이어가 추가된다.

이 관리 레이어를 오케스트레이션이라고 한다. 
주요 도구로는 도커 스웜과 쿠버네티스가 있다.
도커 스웜은 도커에 내장된 형태로, 강력한 컨테이너 오케스트레이션 도구다.
쿠버는 나중에 알아서 알아보자.

최종 목표가 쿠버네티스를 익히는 것이라도 스웜을 먼저 익히는 것이 좋다.
쿠버는 초기 학습 과정이 어렵다. 스웜은 비교적 수월하다.

## 12.1 컨테이너 오케스트레이션 도구란?
도커 컴포즈는 단일 도커 호스트에서 컨테이너 실행을 위한 도구다.
단일 호스트로만 구성되지 않는 경우가 많은데,
단일 호스트의 고장은 전체 애플리케이션 중단을 일으킨다.
서비스의 고가용성을 위해 오케스트레이션이 필요하다.

오케스트레이션 도구란 클러스터를 구성하는 여러 대의 호스트 컴퓨터를 의미한다.
컨테이너들을 관리하고, 작업을 여러 컴퓨터에 분배하고 네트워크 트래픽 부하를 고르게 분산시키고, 상태 불량 컨테이너를 재시작하거나 새 컨테이너로 교체한다.

각 호스트에 도커 설치 후 클러스터를 만들고 오케스트레이션 플랫폼(스웜, 쿠버네티스, ...)에 등록 후 관리한다.

컨테이너 플랫폼은 여러 대의 서버를 묶어 관리한다.
클러스터 API를 통해 yaml을 전달하면, 앱이 배포 되고 오케스트레이션 도구가 어떤 서버에서 어떤 컨테이너를 동작할지 결정한다.

컨테이너는 오케스트레이션 도구에 의해 관리되고, 컨테이너의 건강상태를 보고 한다.
클러스터는 내부에 배포된 앱들에 대한 모든 정보가 담긴 데이터와, 스케줄러, 호스트간 통신 시스템 등이 있다.
일부 컨테이너가 동자하지 않는다면 상태 이상을 체크하여 재실행하거나 새 컨테이너로 대체한다.

## 12.2 도커 스웜으로 클러스터 만들기
도커 스웜은 도커 엔진에 포함돼 있다.
도커 엔진을 스웜 모드로 전환해 클러스트를 초기화하면 된다.

실습) p.345 참고
- docker swarm init
  - 도커 스웜 초기화
  - 클러스터 매니저 - 해당 컴퓨터는 스웜 매니저가 된다.
    - 매니저, 워커 두 가지 역할 중 하나를 맡고, 다른 컴퓨터를 워커로 참여시키는 명령어도 있다.
      - docker swarm join --token SWMTKN-1-3-21kdfsdkfjsdfslvlnfvld-fdvdfvv 192.168.65.3:2377

매니저는 클러스터 관리 작업 직접 수행한다.
클러스터 데이터베이스, API, 컨테이너 모니터링, 스케줄링 모두 매니저 노드에 저장되고 동작한다.
워커는 매니저의 스케줄링에 따라 컨테이너 실행, 상태를 주기적으로 매니저에 보고한다.
물론 매니저도 워커 역할 수행 가능하다.

스웜에 추가된 컴퓨터를 노드라고 부른다.
스웜에 노드로 추가 하려면, 스웜과 같은 네트워크에 있어야 하고, PW 역할을 하는 참가 토큰을 매니저로부터 발급 받아야 한다.
- 같은 네트워크
- 매니저에게 참가 토큰 발급 받기

실습) p.346 참고
- docker swarm join-token worker
  - 워커 참가 토큰
- docker swarm join-token manager
  - 매니저 참가 토큰
- docker node ls

단일 노드나 여러 노드나 동작 방식은 같지만, 
단일 노드는 여러 노드에 비해 높은 고가용성을 가질 순 없고 컨테이너 수를 증가시키는 스케일링이 불가능하다.

개발, 테스트 환경은 단일 노드 스웜으로 충분하다.
동작 방식은 노드가 여러 개 스웜과 동일하다.

운영용 스웜은 세 개의 매니저 노드가 있다.
클러스터 데이터베이스, 스케줄러, 모니터링 등 가용성이 향상된다.
세 개의 매니저 노드로 수백 대의 워커 노드 관리 가능하고,
애플리케이션을 대규모로 스케일링 가능하다.

쿠버네티스보다 도커 스웜은 클러스터 구성, 관리 작업이 단순하다.
- docker swarm init
- docker swarm join

## 12.3 도커 스웜 서비스로 애플리케이션 실행하기

## 12.4 클러스터 환경에서 네트워크 트래픽 관리하기

## 12.5 도커 스웜과 쿠버네티스 중 무엇을 사용할까?

## 12.6 연습 문제
---

# 13장 도커 스웜 스택으로 분산 애플리케이션 배포하기

---

# 14장 업그레이드와 롤백을 이용한 업데이트 자동화

---

# 15장 보안 원격 접근 및 CI/CD를 위한 도커 설정

---

# 16장 어디서든 실행할 수 있는 도커 이미지 만들기: 리눅스, 윈도, 인텔, ARM

---