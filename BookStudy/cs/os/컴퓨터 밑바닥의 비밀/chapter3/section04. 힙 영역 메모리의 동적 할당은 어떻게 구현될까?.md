# 저수준 계층? 메모리라는 사물함에서부터 시작해 보자

##  힙 영역: 메모리의 동적 할당은 어떻게 구현될까?
- 스택 영역은 함수 호출과 밀접한 관련이 있다.
- 모든 함수는 개별 스택 프레임을 갖는다.
- 스택 프레임 정보
  - 반환 주소
  - 함수의 지역 변수
  - 매개 변수
  - 사용되는 레지스터 정보
- 두 가지 주의점!
  1. 함수 호출 완료시 스택 프레임은 무효화된다.
  2. 지역 변수 수명 주기는 함수 호출과 동일하다.

### 3.4.1 힙 영역이 필요한 이유
- 특정 데이터를 여러 함수에 걸쳐 사용하려면?
  - 데이터를 모든 모듈에는 노출하고 싶지 않은 경우
    - 전역 변수? -> 모든 모듈에 노출
    - 개발자가 직접 관리하는 특정 메모리 영역에 저장
- 메모리 수명 주기
  - 개발자가 완전히 직접 제어 할 수 있는 큰 메모리 영역 필요! -> Heap 영역

### 3.4.2 malloc 메모리 할당자 직접 구현하기
- C/C++ 힙 영역 메모리 할당/해제 -> malloc 메모리 할당자
  - 메모리 할당 구현 필요 X, malloc 호출을 통해 메모리 할당

### 3.4.3 주차장에서 메모리 관리까지
- 주차장 입차, 출차 (소형차, 자전거, 대형 트럭)
  - 메모리 크기가 일정 하지 않다.
- 메모리 요청시 적절한 크기의 여유 메모리를 찾아야 한다.
  1. 여유 메모리, 할당 메모리를 어떻게 알 수 있나?
    - 메모리 조직화 필요 -> 메모리 할당 상태 추적 가능
  2. 여러 여유 메모리 조각 중 어떤 것을 반환해야할까?
  3. 큰 메모리를 할당 받았을 때 여분 메모리는 어떻게 해야할까?
  4. 반환 메모리 처리는 어떻게 해야할까?
  - 메모리 할당자는 네 가지를 답해야 한다.

### 3.4.4 여유 메모리 조각 관리하기
- 사용 가능/불가능 메모리 영역 구분 방법이 필요하다.
  - 연결 리스트를 통해 간단히 구현 가능
    - 모든 메모리 조각을 연결 리스트로 관리 가능!
    - 사용 가능 메모리, 할당 메모리 기록하기 편리하다.
    - 연결 리스트, 메모리 사용 정보 -> 메모리 조각 자체에 함께 저장
      - 메모리 조각 비어 있는 상태 설정값(flag)
      - 메모리 크기 기록한 숫자

### 3.4.5 메모리 할당 상태 추적하기

### 3.4.6 어떻게 여유 메모리 조각을 선택할 것인가: 할당 전략
- 할당 전략 문제 -> 여러 전략이 있다.
  1. 최초 적합 방식
     - 가장 간단, 단순
     - 처음부터 검색
  2. 다음 적합 방식
     - 최초 적합 방식과 매우 유사
     - 적합 여유 메모리 조각이 마지막으로 발견된 위치부터 검색
  3. 최적 적합 방식
     - 사용 가능 메모리 조각 모두 찾은 후 요구 사항 만족하면서 가장 크기가 작은 메모리 조각 반환
     - 1, 2에 비해 빠르지 않다.

### 3.4.7 메모리 할당하기
- 