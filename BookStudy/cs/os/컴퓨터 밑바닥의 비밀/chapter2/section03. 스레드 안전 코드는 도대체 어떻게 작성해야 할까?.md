# 프로그램이 실행되었지만, 뭐가 뭔지 하나도 모르겠다.

## 2.3 스레드 안전 코드는 도대체 어떻게 작성해야 할까?
- Thread Safety (스레드 안전)을 이해해야 다중 스레드 프로그래밍이 의미가 있다.
- 스레드 안전을 어떻게 달성 가능한지 이해 해야 한다.

### 2.3.1 자유와 제약
- 스레드 전용 리소스 사용 -> 스레드 안전 보장
- 공유 리소스 사용 -> 스레드간 영향이 없도록 대기 제약 조건 등을 걸어 리소스 사용 -> 스레드 안전 가능

### 2.3.2 스레드 안전이란 무엇일까?
- 스레드 호출 개수, 호출 순서와 상관없이 항상 올바른 결과 -> 스레드 안전하다.
- 스레드 전용 리소스, 공유 리소스를 구분하는 것이 스레드 안전의 핵심!
- 여기서 말하는 공유 리소스란?
    - 여러 리소스에서 읽기 / 쓰기가 가능하다.

### 2.3.3 스레드 전용 리소스와 공유 리소스
- 스레드 전용 리소스
    - 스레드 전용 저장소
    - 함수 지역 변수
    - 스택 영역
- 공유 리소스
    - 그 외
- 공유 리소스 사용 스레드는 반드시 순서를 따라야 한다.
    - 각종 잠금, 세마포어 장치 사용 가능

### 2.3.4 스레드 전용 리소스만 사용하기

### 2.3.5 스레드 전용 리소스와 함수 매개변수
- 함수 매개변수 값이 call by value라면 문제 없다. -> 스레드 안전
    - 스레드 전용 리소스 -> 스택영역 (값으로 전달)
        - 스레드 안전
    - 공유 리소스 -> 데이터 영역 (포인트로 전달)
        - 즉 포인터를 매개변수로 전달하면 스레드 안전하지 못하다. 장치 및 규칙이 필요하다.

### 2.3.6 전역 변수 사용
- 프로그램 시작시 전역 변수 초기화 후 읽기만 한다면 스레드 안전
- 초기화 이후 값이 변경이 된다면 스레드 안전하지 않다.

### 2.3.7 스레드 전용 저장소

### 2.3.8 함수 반환값
- 값 반환 (call by value)
- 포인터 반환 (call by reference)

### 2.3.9 스레드 안전이 아닌 코드 호출하기
- 함수 내에 공유 리소스를 변경하는 소스가 있더라도 잠금을 한다면 스레드 안전이 된다.
    - 잠금으로 전역 변수를 간접적으로 보호 -> 스레드 안전

### 2.3.10 스레드 안전 코드는 어떻게 구현할까?
- 다중 스레드 프로그래밍시 스레드 간에 공유 리소스 고려부터 해야 한다.
- 스레드 전용 저장소
    - 모든 스레드에서 사용하지만, call by value
- 읽기 전용
    - 전역 리소스 사용시 읽기 전용 사용
- 원자성 연산(atomic operation)
- 동기화 시 상호 배제(mutual exclusion in synchronization)
    - 한 번에 하나의 스레드만 공유 리소스 접근하도록 사용자가 직접 제어 필요 상황
        - 뮤텍스 (mutext)
        - 스핀 잠금 (spin lock)
        - 세마포어 (semaphore)