# 프로그램이 실행되었지만, 뭐가 뭔지 하나도 모르겠다.

## 2.2 스레드 간 공유되는 프로세스 리소스
- 매우 중요하다.
- 고전적인 프로세스와 스레드 차이점
    - 프로세스
        - OS가 리소스를 할당하는 기본 단위
    - 스레드
        - 스케줄링의 기본 단위
        - 프로세스 리소스를 공유한다

### 2.2.1 스레드 전용 리소스
- 상태 변화 관점에서 스레드는 함수 실행이다.
    - 함수 실행은 항상 하나의 시작점이 존재한다.
    - 시작점 -> 진입 함수
    - CPU는 진입 함수에서 실행을 시작해 하나의 실행 흐름 생성 -> 스레드라 이름 붙임
- 스레드 전용 리소스
    - 함수 실행 시간 정보
    - 함수 반환 값
    - 다른 함수 호출시 전달되는 매개변수
    - 지역 변수, 레지스터 정보
    - 다음 실행 명령어 주소
    - 스택 상단 위치를 저장하는 스택 포인터
    - PC (Program Counter)
    - 등등등
    - 모든 정보를 통틀어 스레드 상황 정보 (thread context)라고 한다.
- 스레드는 프로세스 내 스택 영역을 제외한 나머지 영역 모두 공유한다.
    - 스택 영역 -> 공유 불가
    - 유휴 영역 -> 공유 가능
    - 힙 영역 -> 공유 가능
    - 데이터 영역 -> 공유 가능
    - 코드 영역 -> 공유 가능

### 2.2.2 코드 영역: 모든 함수를 스레드에 배치하여 실행할 수 있다
- 프로세스 코드 영역
    - 컴파일한 후 생성된 실행 가능한 기계 명령어가 저장된다.
    - 기계 명령어는 실행 파일에 저장된다.
    - 프로세스 내 모든 스레드가 공유하는 영역
    - 읽기 전용

### 2.2.3 데이터 영역: 모든 스레드가 데이터 영역의 변수에 접근할 수 있다.
- 프로세스 코드 영역
    - 전역 변수가 저장되는 곳
    - 프로세스 내 모든 스레드가 공유하는 영역
    - 읽기/쓰기 모두 가능

### 2.2.4 힙 영역: 포인터가 핵심이다.
- 프로세스 힙 영역
    - 프로세스 내 모든 스레드는 특정 변수의 포인터를 얻을 수 있다면 포인터가 가리키는 데이터 접근 가능

### 2.2.5 스택 영역: 공유 공간 내 전용 데이터
- 프로세스 스택 영역
    - 추상화 측면에서 스레드 전용 공간
    - 실제 구현 측면에서 스레드 전용 공간은 아니다.
        - 프로세스간 주소 공간은 서로 격리된다.
            - 일반적으로 서로 직접 접근하지 못하도록 보장한다.
            - 스레드간 스택 영역은 프로세스처럼 보장하진 않는다. -> A스레드에서 B 스레드 스택프레임에서 포인터를 얻을 수 있다면 쓰기/읽기 가능하다!
                - 일반적으로 스레드간 독립 공간을 갖고 있지만, 다른 스레드에 의해 장애 발생 가능성도 존재한다.
                    - ex) C 기준 -> 주 스레드, 새 스레드(주 스레드 매개 변수) -> 새 스레드에서 포인터를 통해 변수 제어(새 스레드, 즉 함수 내에서)

### 2.2.6 동적 링크 라이브러리와 파일
- 링커는 컴파일 후 최종적으로 실행 파일을 생성하는 핵심적인 단계다.
- 링크는 정적, 동적 두 가지 링크 유형이 있다.
    - 정적 링크
        - 실행 파일에 종속된 모든 라이브러리 포함 O
        - 실행 파일에 모든 코드와 데이터 포함 -> 프로그램 시작시 추가 작업 X
    - 동적 링크
        - 실행 파일에 종속된 모든 라이브러리 포함 X
        - 실행 파일에 모든 코드와 데이터 포함 -> 프로그램 시작, 실행시 추가 작업 O
            - 추가 작업 -> 종속된 라이브러리 코드와 데이터 -> 프로세스 주소 공간에 넣는 링크 과정 필요
            - 동적 라이브러리 코드와 데이터는 프로세스의 '여유 공간'에 배치된다.

### 2.2.7 스레드 전용 저장소
- 스레드 전용 데이터
    - 모든 스레드에서 접근 가능
        - 동일한 값을 읽을 순 있지만, 깊은 복사 (변경 불가, 해당 스레드 안에서만 변경)