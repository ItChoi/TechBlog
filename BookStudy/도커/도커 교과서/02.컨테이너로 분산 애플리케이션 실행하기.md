앱은 대게 여러 요소로 분할 돼 구성된다.

# 7장 도커 컴포즈로 분산 애플리케이션 실행하기
도커는 n-티어 모놀리식 설계부터 MSA 설계까지 분산 컴포넌트 관리에 이상적이다.

## 7.1 도커 컴포즈 파일의 구조
Dockerfile 스크립트는 애플리케이션을 패키징을 위한 스크립트다.
Dockerfile 스크립트 = App Packaging 스크립트

분산 앱은 단지 한 부분을 패키징하는 수단으로 보면 된다.
백 / 프론트로 나뉜 경우 두 개의 도커 파일이 필요하다.
백엔드가 MSA로 여러 도메인으로 분할 관리하는 경우, 다시 n개만큼 도커 파일이 필요하다.

직접 순서대로 여러 도커파일을 수동으로 옵션을 지정해 실행 할 수 있지만,
실수 가능성이 높아진다. 심지어 앱 동작의 문제가 생길 수 있다.
이런 경우 도커 컴포즈 파일에 앱 구조를 정의하면 된다.

컨테이너 실행시 지정할 모든 옵션과 도커 네트워크, 볼륨 등 도커 API에 명령을 내린다.

ex)
```dockerfile
verison: '3.7'

services:
    todo-web:
        image: diamol/ch06-todo-list
        ports:
            - "8020:80"
        networks:
            - apt-net
networks:
    app-net:
        external:
            name: nat
```
- 도커 컴포즈는 문법이 이해하기 쉽고, json 변환에 용이한 YAML 문법으로 기술된다.
- 예제상 세 개의 최상위 문으로 구성된다.
  1. version
     - 도커 컴포즈 파일 형식 버전
  2. services
     - 앱 구성 모든 컴포넌트 열거
     - 실제 컨테이너 대신 서비스 개념을 단위로 삼는다.
  3. networks
     - 서비스 컨테이너가 연결될 모든 도커 네트워크 열거
- diamol/ch06-todo-list 이미지를 통해 단일 컨테이너로 실행된다.
- 컨테이너의 80번 포트를 호스트 컴퓨터 8020번 포트를 통해 공개한다.
- app-net 정의된 app-net 도커 네트워크에 접속
- 서비스 이름은 컨테이너 이름이자 도커 네트워크상 다른 컨테이너가 식별할 수 있게 한다.
- 서비스 구성 네트워크는 app-net
- app-net 네트워크는 net이라는 외부 네트워크로 연결된다.
- external 의미는 nat 네트워크는 이미 존재하므로, 새로 생성하지말라는 것이다.
  - 여기에 설정된 네트워크가 존재하지 않는 경우 도커 네트워크를 생성한다.


도커 컴포즈는 도커 명령과는 다르게, 앱 실행을 위해 up 명령을 실행해야 한다.
up을 통해 컴포즈 파일 체크, 정의된 상태로 실행하기 위해 필요 요소 준비를 시작

실습) 도커 네트워크 생성, 예제를 받은 후 도커 컴포즈 실행해보기
- docker network create nat
- cd ./ch07/exercises/todo-list
- docker-compose up

docker-compose up 실행시 현재 작업 디렉토리에서 docker-compose.yml 파일을 찾는다.
그리고 서비스들을 읽어들이고, 설정한 이미지를 내려 받고, 컨테이너를 실행하고, 컨테이너는 정의된대로 동작한다.
또한 간접적으로 문서화 효과를 얻을 수 있다.
단일 서비스라면 몰라도 여러 서비스로 구성된 도커 컨테이너는 도커 컴포즈 파일이 꼭 필요하다.

## 7.2 도커 컴포즈를 사용해 여러 컨테이너로 구성된 애플리케이션 실행하기

## 7.3 도커 컨테이너 간의 통신

## 7.4 도커 컴포즈로 애플리케이션 설정값 지정하기

## 7.5 도커 컴포즈도 만능은 아니다.

## 7.6 연습 문제


# 8장 헬스 체크와 디펜던시 체크로 애플리케이션의 신뢰성 확보하기

# 9장 컨테이너 모니터링으로 투명성 있는 애플리케이션 만들기

# 10장 도커 컴포즈를 이용한 여러 환경 구성

# 11장 도커와 도커 컴포즈를 이용한 애플리케이션 빌드 및 테스트
