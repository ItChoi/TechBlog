기본적인 데이터 입출력을 다뤄보자.
1. 컬렉션에 새 도큐먼트 추가
2. 컬렉션에서 도큐먼트 삭제
3. 기존 도큐먼트 갱신
4. 연산 수행시 안정성과 속도 중 적절한 선택

# 3.1 도큐먼트 삽입
- insertOne 메서드 사용
  - db.movies.insertOne({"title" : "Stand by Me"})
    - 몽고 DB에 해당 도큐먼트 저장

## 3.1.1 InsertMany
- 여러 도큐먼트를 컬렉션에 삽입한다.
- 단일로 여러 개를 삽입하는 것 보다 한 번에 도큐먼트를 삽입하는 방식이 매우 빠르다.
  - 건 수가 많아질수록 차이가 벌어진다.
- 단일 컬렉션에 삽입할 때 매우 유용하다.
- mongoimport 명령행도 있다.
  - 데이터 피드, 다른 DBMS 원본 데이터 일괄 삽입
- 중간에 특정 도큐먼트 오류 발생시 '정렬 연산', '비정렬 연산' 선택에 따라 상황이 달라진다.
  - default는 정렬 삽입
  - 비정렬 삽입 -> 모든 도큐먼트 삽입
  - 정렬 삽입 -> 도큐먼트가 삽입 오류 생성시 배열에서 해당 지점 벗어난 도큐먼트는 삽입 안함
  - 도큐먼트 내에 {"ordered" : false} 주입

## 3.1.2 삽입 유효성 검사
- 삽입 데이터 최소한의 검사 실행
  - "_id" 필드 존재 여부
    - 없으면 새로 추가
    - 모든 도큐먼트는 16MB 작아야 하므로 크기 검사
  - 유효하지 않은 데이터가 입력되기 쉬운 환경이라 검사는 최소한의 검사는 필수다.
  
## 3.1.3 삽입
- insert 방법도 있지만, insertOne, insertMany를 사용하자.

# 3.2 도큐먼트 삭제
- deleteOne, deleteMany 제공
  - 첫 번째 매개변수로 도큐먼트 입력
  - "_id"를 기준으로 삭제 시 deleteOne 사용
- 컬렉션 내 여러 도큐먼트 필터로 일치시 deleteOne은 첫 번째 도큐먼트만 삭제
  - 첫 번째 도큐먼트는 상황에 따라 다르다.
- delete 방식도 있지만, deleteOne, deleteMany를 사용하자.

## 3.2.1 drop
- deleteMany 사용하여 컬렉션의 모든 도큐먼트 제거 가능
- 전체 컬렉션 삭제시 drop 사용하는 편이 빠르다.
- 데이터는 한 번 제거하면 영원히 사라진다.

# 3.3 도큐먼트 갱신
- updateOne, updateMany, replaceOne 사용
  - replaceOne는 교체할 도큐먼트를 지정한다.

## 3.3.1 도큐먼트 치환
- friends, enemies 필드를 relationships 서브 도큐먼트로 옮길 수 있다.

## 3.3.2 갱신 연산자
- 도큐먼트 내 특정 부분 갱신 작업하는 경우가 많다.
- 부분 갱신 연산자 사용
  - 값 증가시 "$inc" 제한자 사용
- "$set" 제한자 사용하기
  - 필드 값을 설정한다.
    - 미존재시 새 필드로 생성된다.
  - 내부 데이터 변경시에도 사용한다.
- 증가와 감소
  - "$inc" 연산자는 이미 존재하는 키의 값을 변경하거나 새 키 생성시 사용
    - 숫자 증감을 위해 설계, 기존 값에 연산시에도 사용하면 된다.
    - int, long, double, decimal 타입에만 사용 가능
- 배열 연산자
  - 요소 추가
    - "$push"
      - 아마 존재시 추가
      - 없다면 새로운 배열 생성
    - "$each" 제한자
      - $push와 같이 사용하면 한 번의 작업으로 여러 개 추가 가능
    - 배열 길이 변경
      - $slice
    - $ne
    - $addToSet
      - 중복을 피할 수 있다.
  - 요소 제거하기
    - "$pop"
      - 배열의 마지막 요소 제거, 때로는 배열 위치가 아니라 지정 조건에 따라 제거 가능
    - "$pull"
      - 조건과 일치하는 모든 도큐먼트 제거
  - 배열의 위치 기반 변경
  - 배열 필터 이용한 갱신
    - arrayFilters 활용

## 3.3.3 갱신 입력
- 갱신 조건에 일치 도큐먼트가 없을 시 새로운 도큐먼트 생성
- $setOnInsert
  - 도큐먼트 삽입시에만 필드 값 설정
    - 생성일 등
- 저장 셸 보조자
  - save
    - 미존재시 도큐먼트 삽입
    - 존재시 갱신

## 3.3.4 다중 도큐먼트 갱신
- 필터링된 도큐먼트 모두 수정시 updateMany 사용

## 3.3.5 갱신한 도큐먼트 반환
- 과거 FindAndModify를 사용했다.
  - 삭제, 대체, 갱신 세 가지 기능이 결합 -> 사용자 오류 발생 가능성이 높다.
- 중간 FindOneAndDelete, FindOneAndReplace, FindOneUpdate
- 그나마 최근 $addFields, $project, $replaceRoot


  