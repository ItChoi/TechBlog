# 4장 주요 내용
- 스키마 설계
- 전자상거래 데이터 모델
- 데이터베이스, 컬렉션, 도큐먼트의 실제적 세부사항들

---

- 몽고DB -> 데이터베이스, 컬렉션, 도큐먼트 단위 구성 살펴보기.
  - 스키마를 강제하진 않지만, 기본적인 내부 기준 정도는 존재해야 한다.
  - 1:N, N:M 관계 표현 방식 이해 필요
  - 전자상 거래 예시 -> 뒷 장에 쿼리, 집계, 업데이트 등 기초가 된다.
  
## 4.1 스키마 설계 원리
- DB 시스템 모델링시 제기할 수 있는 질문
  1. 애플리케이션의 액세스 패턴은 무엇인가?
     - 앱의 요구사항
     - 읽기/쓰기 비율
     - 쿼리 복잡성 수준
     - 집계 데이터 사용 여부
     - 데이터 저장 수치
  2. 데이터베이스에 어떤 기능이 있는가?
     - RDBMS
       - 애드혹 쿼리 및 조인 특징
       - 정교한 데이터 수정 가능
     - 몽고DB
       - 애드혹 쿼리 허용, 조인 지원 X
       - 기존 방식 트랜잭션 지원은 없지만, 다양한 업데이트 지원
     - unique key, pk를 무엇으로 만드는가?

## 4.2 전자상거래 데이터 모델 설계
- 전자상거래는 전적으로 RDBMS에 속한 도메인이었다.
  - 이유
    1. 일반적으로 트랜잭션이 필요 (현재는 몽고DB도 트랜잭션 지원이라 내용 체크 필요)
    2. 다양한 데이터 모델, 동적 쿼리

## 4.2.1 스키마 기본
- RDBMS -> 테이블 정규화가 일반적이지만, 몽고DB는 하나의 컬렉션으로 대체 가능
- 고유한 슬러그
- 중첩 도큐먼트
  - 상품에 대한 자세한 정보를 갖는 서브도큐먼트
- 일대다 관계
  - 상품, 카테고리 관계
- 다대다 관계
  - 상품, 카테고리(주요, 서브) 관계
- 관계 구조

### 4.2.2 사용자와 주문
- db.orders.find({user_id: user['_id']})
- 도큐먼트에 대한 생각

### 4.2.3 상품평
- 상품평 도큐먼트에 추천수 저장

## 4.3 실제적 세부사항: 데이터베이스, 컬렉션, 도큐먼트

### 4.3.1 데이터베이스
- 데이터베이스는 컬렉션, 인덱스의 물리적인 모음 -> 네임스페이스
- 데이터베이스 관리
  - 데이터베이스 -> 첫 컬렉션 쓰기 -> 자동 생성
    - use garden
      - 컬렉션이 없다면 아직 데이터베이스 생성 상태 X
  - products.find({}).delete_many
    - 컬렉션 내 모든 데이터 삭제
  - products.drop
    - 컬렉션 삭제
  - db.drop
    - 모든 컬렉션 삭제
  - 데이터베이스 삭제 -> 디스크로부터 삭제 -> 복구 불가
- 데이터 파일과 할당
  - MongoDB -> 데이터베이스 생성 -> 데이터 파일 디스크에 할당 (모든 컬렉션, 인덱스, DB 메타데이터, ...)
    - /data/db 경로에 저장
    - mongod.lock: 서버의 프로세스 ID 저장
    - choisinsa 데이터베이스 생성 -> choisinsa.ns (namespace) 파일이 만들어짐
      - ns 파일은 16MB 고정, 26000개 엔트리 저장 가능 -> 인덱스와 컬렉션 개수 26000 이하만 생성 가능 - 조절 가능
      
### 4.3.2 컬렉션
- 컬렉션 관리
  - db.createCollection("users", {size: 20000})
