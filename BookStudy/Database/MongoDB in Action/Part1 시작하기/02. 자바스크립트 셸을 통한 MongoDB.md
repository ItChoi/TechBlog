# 2장 주요 내용
- MongoDB 셸에서 CRUD 연산
- 인덱스 생성과 explain() 사용
- 기본적인 관리의 이해
- 도움말 얻기

---

## 2.1 MongoDB 셸 경험하기

### 2.1.1 셸 시작하기

### 2.1.2 데이터베이스, 컬렉션, 도큐먼트
- user, order 등 다른 유형 도큐먼트들은 별도 공간에 저장할 수도 있다.
  - 도큐먼트 간에 그루핑 방법이 필요하고, 이를 컬렉션이라 부른다. (?)
- MongoDB는 컬렉션들을 별개의 데이터베이스에 분리한다.
  - 질의를 위해 대상 도큐먼트가 존재하는 데이터베이스(네임스페이스)와 컬렉션을 알아야 한다.
- 데이터베이스 지정하지 않을 경우 test 기본 설정 데이터베이스에 연결된다.
- 몽고 DB가 데이터를 디스크에 쓰는 방법 때문에 데이터베이스와 컬렉션 모두 사용해야 한다.
  - 데이터베이스 내 모든 컬렉션은 같은 파일에 그루핑 -> 관련 컬렉션 보관 용도

### 2.1.3 삽입과 질의
```mongodb-json
use test1
db.users.insert({username: "smith"})
db.users.find()

use test2
db.users.find()
```
- test1 데이터베이스에서 조회시 1건
- test2 데이터베이스 사용 후 조회시 0건

- MongoDB의 _ID 필드
  - PK라고 생각하면 된다.
  - 도큐먼트 생성시 _ID 필드가 없다면 도큐먼트에 자동으로 추가된다. (ObjectID)
  - db.users.insert({username: "jones"})
  - db.users.count() -> deprecated
  - db.users.countDocuments()
- 질의 술어 넘겨주기
```mongodb-json
db.users.find({"_id": ObjectId("6846b84afb66831b1733a51d"), "username": "smith"})
db.users.find({
    "_id": ObjectId("6846b84afb66831b1733a51d"), "username": "smith"
})

db.users.find({
    "email": "choi@study.com",
    "email": "lee@carrot.com"
})

db.users.find({
    $or: [
      {"email": "choi@study.com"},
      {"email": "lee@carrot.com"}
    ]
})

db.users.find({
    "email": {
        $in: [
            "choi@study.com",
            "lee@carrot.com",
        ]
    }
})
```

### 2.1.4 도큐먼트 업데이트
- 업데이트 쿼리는 최소 두 개 매개변수 필요
  - 1 -> 업데이트 할 도큐먼트
  - 2 -> 수정할 내용
- update() -> 단일 도큐먼트 업데이트
- 연산자 업데이트
  - 단일 필드를 명시된 값으로 설정 -> $set
    - 도큐먼트 대체가 아니라면 $set 연산자 사용하기
  - 도큐먼트 대체 -> 왜 난 에러가?
```mongodb-json
db.users.update({username: "smith"}, {$set: {country: "Canada"}})
db.users.update({username: "smith"}, {country: "Canada"})
db.users.update({country: "Canada"}, {$set: {username: "smith"}})
```

- 사용하지 않을 필드는 $unset 사용
```mongodb-json
db.users.update({username: "smith"}, {$unset: {country: 1}})
```

- 복잡한 데이터 업데이트
```mongodb-json
{
    username: "smith",
    favorites: {
        cities: ["Chicago", "Cheyenne"],
        movies: ["Casablance", "For a Few Dollars More", "The Sting"]
    }
}

db.users.update( 
    {username: "smith"},
    {
        $set: {
            favorites: {
                cities: ["Chicago", "Cheyenne"],
                movies: ["Casablance", "For a Few Dollars More", "The Sting"]
            }
        }
    }
)
```

- find() 명령은 반환 도큐먼트에 커서(cursor)를 반환한다.
```mongodb-json
db.users.find({"favorites.cities": "Chicago"})
```
- 객체 접근은 ""로 감싸야 한다.

- 더 발전된 업데이트
  - 여기서부터 다시 보기
