# 이미지와 컨테이너

## 파트 소개

## 이미지
- 파일 시스템의 특정 시점을 저장해놓은 압축 파일
  - 소프트웨어 실행에 필요한 모든 요소가 압축되어 있다.
  - OS 위 nginx 의존성들을 모두 준비 후 이미지로 저장후 공유 (OS, config, 프로그램 모두 포함)
-백업 용도로 사용 가능, 가상 머신에서는 스냅샷이라는 기능을 제공한다.
- 컨테이너 이미지는 백업, 스냅샷보다 파일 사이즈가 아주 작다! 

## 이미지와 컨테이너
- 프로그램 -> 이미지
  - 디스크 공간 차지
  - 실행 가능한 SW
- 프로세스 -> 컨테이너
  - 실행 상태의 SW
  - 프로그램 1:N 프로세스
  - CPU, Memory 등 리소스 사용
- 이미지 
  - 디스크 공간 차지
  - 실행 가능한 SW + 실행에 필요한 환경
- 컨테이너
  - 실행 상태의 이미지
  - 이미지 1:N 컨테이너
  - CPU Memory 등 리소스 사용
  - 컨테이너간 리소스 격리
  - 이미지를 복사해 격리된 디스크 공간 생성
  - 컨테이너 실행시 프로세스도 함께 실행
- 명령어
  - docker image ls (이미지명)
    - 로컬 이미지 조회
  - docker run -d --name {컨테이너명} 이미지명
    - -d: 백그라운드 실행
    - --name: 컨테이너 이름 지정
  - docker ps
    - 실행 중 컨테이너 조회
  - docker rm -f 
    - 실행중 컨테이너 삭제
    - rm만으로는 실행중 컨테이너 삭제 불가

## 이미지의 메타데이터(Metadata)
- 메타데이터
  - 데이터에 대한 데이터!
    - 이미지가 압축된 데이터 -> 이미지에 대한 정보를 기술한 데이터(메타데이터)
- 이미지 구성
  - 실제로 압축된 파일
  - 파일 정보가 저장된 메타데이터
    - id
    - Env
      - 앱이 사용하는 환경설정 값, 키와 값으로 구성
      - SW가 실행시 참조할 설정 정보
    - Cmd
      - 컨테이너 실행시 프로세스 실행 명령어 지정
      - 실행 명령어를 통해 env 값 등을 사용한다.
      - 실행시 새로운 값으로 덮어쓰기 가능
      - 띄어쓰기 인식 X, 띄어쓰기 기준 배열로 저장
    - ...
- 명령어
  - docker image inspect 이미지명
    - 이미지 세부 정보 조회
  - docker container inspect 컨테이너명
    - 컨테이너 세부 정보 조회
  - docker run 이미지명 (실행명령)
    - 컨테이너 실행시 메타데이터의 cmd 덮어쓰기
  - docker run --env KEY=VALUE 이미지명
    - 컨테이너 실행시 메타데이터 env 덮어쓰기
  - cat 명령어
    - 리눅스 제공 기본 명령어 -> 파일 내용 출력
    - 출력후 종료 -> 1회성 명령어
    - 실행 명령으로 cat을 할 경우 cat이 종료되면서 컨테이너도 종료된다.
- 환경 변수나 실행 명령을 덮어쓰는 방식은 일반적으로 하지 않지만 디버깅을 위해서 사용하기도 한다.

## 컨테이너의 라이프사이클(Lifecycle)
- 이미지에서부터 시작한다.
- 이미지는 앱 실행을 위해 모든 환경이 준비된 압축 파일이다.
- create - 생성 단계에서 컨테이너 실행을 위한 격리 공간 생성
  - 네트워크, 스토리지, 환경 변수 등이 격리된 공간인 컨테이너로 분리된 상태
  - 실제 프로세스 실행 X -> Host OS의 자원 사용 X
- running - 실행 상태
  - 정상적으로 컨테이너 내부 프로세스 실행 상태, 자원 사용 상태
  - run -> create + start
- 명령어
  - docker logs 컨테이너명
    - 컨테이너 로그 조회
  - docker start -i tencounter
    - -i: 컨테이너 실행과 동시에 출력을 터미널로 연결할 수 있다.
  - docker logs -f 컨테이너명/id
    - 실시간 로그 확인 가능