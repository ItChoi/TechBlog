# 섹션 4. [기초편] 기본 오브젝트

## ConfigMap, Secret - Env, Mount
- dev, prod 환경
  - dev
    - pod - container - A Service
      - SSH false
      - User Dev
      - Key LSOtLs...
  - prod
    - pod - container - A Service
      - SSH true
      - User Prod
      - Key MII3Ld..
- 두 설정이 다르다고 이미지 두 개를 만들어 관리하는 것은 부담된다.
  - 설정 사용으로 해결!
  - 환경에 따라 변하는 값 -> 외부에서 결정 -> ConfigMap, Secret 사용
    - ConfigMap
      - SSH true
      - User Prod
    - Secret
      - Key MII3Ld..
- ConfigMap
  - key/value 구성
    - Secret과 다르게 무한
- Secret
  - 보안적인 관리 필요시 사용
  - key/value 구성 -> value는 base64 인코딩 후 만든다.
    - 파드에 주입될 땐 디코딩 돼서 원래 값이 보이게 된다.
    - 1MB까지만 제한 -> 메모리 사용으로 많이 만들면 시스템 자원에 영향을 준다. 
  - k8s 메모리에 저장된다.
    - 일반적인 오브젝트 값은 k8s db에 저장
    - 파일 저장보다 메모리 저장이 보안에 좋다.
- 컨테이너 환경변수 ENV에 ConfigMap, Secret 설정 데이터들이 들어간다.
  - 이미지 하나로 환경 변수를 제어해 원하는 환경 사용 가능!
- 사용 방법
  - ENV (Literal)
    - 파드 생성시 ConfigMap을 가져와 컨테이너 환경 변수 세팅 가능
      - Secret도 마찬가지 - 디코딩되어 세팅
    - ConfigMap, Secret -> data: key: value
    - Pod -> spec.containers.envFrom: - configMapRef: name: configmap-name
    - Pod -> spec.containers.envFrom: - secretRef: name: secret-name
  - ENV (File)
    - 파일을 통으로 configMap에 담을 수 있다.
      - key -> 파일명
      - value -> 파일 내용
    - kubectl create configmap cm-file --from-file=./file.txt
    - kubectl create secret generic sec-file --from-file=./file.txt
      - 파일 내용이 base64 인코딩 된다 (이미 인코딩 된 경우 2번 인코딩 발생)
    - Pod -> spec.containers.env.valueFrom.ConfigMapKey.Ref.name: cm-file
    - Pod -> spec.containers.env.valueFrom.ConfigMapKey.Ref.key: file.txt
    - ConfigMap 데이터가 변경돼도 파드 환경 변수에 영향 없다.  
  - Volume Mount (File)
    - file을 ConfigMap에 담는다.
    - 파드 생성시 mountPath 정의 -> 파일 마운트
    - Pod -> spec.volumes.configMap.name: cm-file
    ConfigMap 데이터가 변경되면 파드 환경 변수 적용! - 마운트니까 당연