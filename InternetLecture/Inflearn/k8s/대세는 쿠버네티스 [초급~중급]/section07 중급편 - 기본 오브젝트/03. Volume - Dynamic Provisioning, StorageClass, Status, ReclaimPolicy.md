# 섹션 7. [중급편] 기본 오브젝트

## Volume - Dynamic Provisioning, StorageClass, Status, ReclaimPolicy
- 볼륨은 실제 k8s 클러스터와 분리가 돼서 관리된다.
- 볼륨 종류
  - 내부망 (Internal Network)
    - k8s 구성 노드 존재 (master, node1, ...)
    - k8s hostPath, Local Volume 존재
    - 온프레미스 스토리지 솔류션 -> 노드에 설치 가능
      - GlusterFS, ceph, STORAGEOS, ...
    - NFS
  - 외부망 (External Network)
    - AWS
    - GCP
    - MS Azure
- K8s 클러스터 밖에 실제 볼륨 마련
  - 액세스 모드
    - 실제 볼륨마다 지원하는 액세스 모드가 다르다.
    - RWO (ReadWriteOnce)
    - ROM (ReadOnlyMany)
    - RWM (ReadWriteMany)
  - k8s 관리자 -> pv (PersistentVolume) 생성 -> 볼륨 연결
    - 저장 용량, 액세스 모드 지정
  - k8s 사용자 -> pvc (PersistentVolumeClaim) 생성 -> PV 연결 (k8s가 자동으로 적절한 pv와 연결해준다.)
    - 원하는 용량, 액세스 모드 지정
  - Pod에서 PVC 사용!
- PV는 상태가 존재한다.
  - PVC 연결 상태인지 확인 가능
  - 에러가 났는지 체크 가능
- k8s - Dynamic Provisioning
  - 사용자가 PVC 생성시 알아서 PV 생성하고 실제 볼륨과 연결해주는 기능이 있다.
  - 사전 작업으로 지원해주는 스토리지 솔루션 선택 후 설치 필요!
    - 설치 가장 간편 -> STORAGEOS
    - 설치시 Service, Pod, Secret 등 여러 오브젝트가 생성된다.
      - 중요한건 StorageClass 오브젝트!
        - 동적으로 PV 생성 가능
        - PVC - StorageClassName 속성
          - 빈 값 -> 적절한 PV에 연결 (k8s 자동)
            - StorageClass default 설정시 PV 생성된다.
          - StorageClass 지정 -> 자동으로 스토리지 OS 볼륨을 가진 PV 생성
        - StorageClass는 추가 생성 및 default 설정 가능
- 볼륨의 Status & ReclaimPolicy
  - Status
    - Available: 최초 PV 생성 
    - Bound: PV - PVC 연결
      - PV를 직접 만드는 경우 볼륨 실제 데이터 생성 상태 X, 파드가 PVC를 사용해서 구동될 때 실제 볼륨 생성
    - Released: PVC와 연결이 끊어진 상태
    - Failed: PV와 실제 데이터 간 연결 문제
  - ReclaimPolicy
    - PVC 삭제시 PV ReclaimPolicy 속성 설정에 따라 PV 상태가 달라질 수 있다.
    - ReclaimPolicy
      - Retain (default) -> PVC 삭제시 PV Released, 실제 볼륨 데이터는 유지되지만 재사용 불가 -> 수동 삭제  
      - Delete -> PVC 삭제시 PV 함께 삭제 -> 볼륨 종류에 따라 실제 데이터가 삭제 될 수도 있다.
      - Recycle -> PVC 삭제시 PV Available, 데이터 삭제되고 재사용 가능, 현재 Deprecated