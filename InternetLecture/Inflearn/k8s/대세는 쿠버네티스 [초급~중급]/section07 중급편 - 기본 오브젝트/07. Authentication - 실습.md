# 섹션 7. [중급편] 기본 오브젝트

## Authentication - 실습
- 인증서를 통해 http/https api 요청해보기.
  - cluster에 있는 kubeconfig 파일 확인
  - Client Key, 인증서를 가져와서 https api 요청해보기
  - kubectl로 프록시를 띄워 http api 요청해보기
- kubeconfig 인증서 확인 
  - cat /etc/kubernetes/admin.conf
    - 값은 Base64로 인코딩
      - ca 인증서
      - 클러스터 정보
      - 유저 - 클라이언트 인증서, 클라이언트 키
- kubeconfig 인증서 - decode 출력후 피시에 복사해오기
  - grep 'client-certificate-data' /etc/kubernetes/admin.conf | head -n 1 | awk '{print $2}' | base64 -d
    - client.crt 붙여넣기
  - grep 'client-key-data' /etc/kubernetes/admin.conf | head -n 1 | awk '{print $2}' | base64 -d
    - client.key 붙여넣기
- api 요청 - 포스트맨 & curl
  - curl -k --key ./Client.key --cert ./Client.crt https://192.168.56.30:6443/api/v1/nodes
- kubectl proxy -> http api 요청해보기
  - kubeadm / kubectl / kubelet 설치 (k8s 설치시 설치되어 있다.)
    - yum install -y --disableexcludes=kubernetes kubelet-1.27.2-0.x86_64 kubeadm-1.27.2-0.x86_64 kubectl-1.27.2-0.x86_64
  - admin.conf 인증서 복사 (k8s 설치시 기본적으로 적용되어 있다.)
    - mkdir -p $HOME/.kube
    - sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
    - sudo chown $(id -u):$(id -g) $HOME/.kube/config
  -  Kubectl Proxy 띄우기
    - nohup kubectl proxy --port=8001 --address=192.168.56.30 --accept-hosts='^*$' >/dev/null 2>&1 &
      - 백그라운드에서 kube proxy가 8001로 돌고 있다.
      - http api 요청 가능!
        - curl http://192.168.56.30:8001/api/v1/nodes
- 선택한 클러스터에서 조회
  - kubectl cli 설치 필요 - 운영체자마다 다운로드 필요
- Service Account
  - 네임스페이스 생성 (nm-01)
    - 자동으로 생성되는 서비스 어카운트 (default)와 Secret 체크!
    - 파드 생성 후 토큰을 가지고 k8s api 접근해보기.
  - kubectl create ns nm-01
  - kubectl describe -n nm-01 serviceaccounts
  - kubectl describe -n nm-01 secrets
