# 섹션 7. [중급편] 기본 오브젝트

## Authorization - RBAC, Role, RoleBinding
- RBAC
  - 역할 기반 권한 부여
  - Role, RoleBinding로 기능 수행
  - k8s 자원 구분
    - 클러스터 단위 관리 자원
      - Node
      - PV
      - Namespace
    - Namespace 단위로 관리 자원
      - Pod
      - Service
  - Namespace 생성시 자동으로 Service Account가 만들어지기도 한다.
    - Service Account -> Role, RoleBinding 설정에 따라 접근 권한이 다르다.
  - Role
    - 여러 개 만들 수 있다.
    - 네임스페이스 자원 접근 권한 설정 가능
  - RoleBinding
    - Role(1) - (N)ServiceAccount 연결해주는 역할
    - ClusterRole - RoleBinding - ServiceAccount
      - Role이 아닌 RoleBinding과 SA를 연결해줄 수도 있다.
      - SA는 클러스터 자원에 접근 X, 자신의 네임스페이스 내 자원만 사용 가능! 
        - 즉 그냥 Role을 사용하는 것과 같다. 
          - 모든 Namespace마다 똑같은 Role을 부여하고 관리해야 되는 상황에 사용!
  - Service account를 통해 클러스터 자원 접근
    - ClusterRole, ClusterRoleBinding이 필요하다.
      - ClusterRole
        - 클러스터 단위의 오브젝트들을 지정할 수 있다. (Role 기능과 동일)
      - ClusterRoleBinding
        - ClusterRole - ServiceAccount 연결 
          - ServiceAccount에 cluster 접근 권한 획득
- Role & RoleBinding Detail
  - 가정 1
    - 네임스페이스 생성 (nm-01)
      - 네임스페이스 생성시 자동으로 SA(default), Secret(ca.crt, token) 생성 
    - nm-01 내에 Service1, Pod1 생성
    - Role 생성 (r-01)
      - apiGroups: ["batch"]
        - 파드는 core api로 넣지 않아도 된다.
        - resources jobs인 경우 batch 추가 필요
      - resources: [pods, jobs]
        - pods: 파드일 경우 추가
      - verbs: [get, list]
        - 조회만 가능한 속성
    - RoleBinding 생성 (rb-01)
      - roleRef: Role
      - subjects: SA
  - 가정 2
    - 네임스페이스 생성 (nm-02)
    - ServiceAccount 생성 (sa-02) - Secret(ca.crt, token)
    - ClusterRole 생성 (cr-02)
      - apiGroups: [*]
      - resources: [*]
      - verbs: [*]
    - ClusterRoleBinding 생성 (crb-02)
      - roleRef: ClusterRole (cr-02)
      - subjects: SA (sa-02)
    - SA 토큰을 통해 API 서버 접근 - 다른 네임스페이스, 클러스터 자원 접근 가능!